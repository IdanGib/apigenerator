<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>API</title>
    <link rel="stylesheet" href="index.css">
</head>
<body>
    <div class='app'>
        <div class='header'>API</div>
        <div class='list'>
            <div id="apis"></div>
            <div class="create-api">
                <button id="createbtn">create</button>
                <input id="createname" type="text" id="apiname" placeholder="name" >
            </div>
        </div>
        <div class='editor'>
            <input type="text" id="updatename"  disabled>
            <textarea  id="updatecontent" cols="30" rows="10"></textarea>
            <div>
                <button id="updatebtn">update</button>
            </div>
        </div>
        <div class='footer'></div>
    </div>

    <script src="/index.js"></script>

    <script>
        function g(id) {
            return document.getElementById(id);
        }
        const elements = {
            apis: g('apis'),

            createbtn: g('createbtn'),
            createname: g('createname'),

            updatecontent: g('updatecontent'),
            updatename: g('updatename'),
            updatebtn: g('updatebtn')
        };
        const env = { url: `http://localhost:3000` };

        api.init({ elements, env }).then(async api => {

            const { 
                apis, 
                createbtn, 
                updatecontent, 
                updatebtn, 
                updatename 
            } = elements;


            async function updateList() {
                const { data } = await api.list();
       
                const list = data.map(name => {
                    const item = document.createElement('div');
                    item.innerText = name;
                    item.classList.add('item');
                    item.onclick = async event => {
                        const { data, err } = await api.read(name);
                        updatecontent.value = data || '';
                        updatename.value = name;
                    }
                    const removebtn = document.createElement('button');
                    removebtn.innerText = 'delete';
                    removebtn.onclick = async event => {
                        const res = await api.delete(name);
                        console.log(`${name} deleted`, res);
                        updateList();
                        event.stopPropagation();
                        event.preventDefault();
                        return true;
                    };
                    item.appendChild(removebtn);
                    return item;  
                });
                apis.innerText = '';
                for(const li of list) {
                    apis.appendChild(li);
                }

            }

            updateList();

        
            updatebtn?.addEventListener('click', async event => {
                const content = updatecontent.value;
                const name =  updatename.value;              
                const { data, err } = await api.update(name, content);
            })

            createbtn?.addEventListener('click', async event => {
                const name = createname.value;
                if(name) {
                    await api.create(name);
                    updateList();
                }
            });

        }).catch(console.error);
    </script>
</body>
</html>